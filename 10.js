const input = '<{([{(<[(<[({<{}[]>([]{})})((<{}[]>{[]{}})([(){}]<()<>>))]>)({([<{<>[]}(<>[]>>][([()[]]{[]()})<(<>{}|[[[[[({(([<[[([][])<<>()>]{<[]{}>(()<>)})(<<<>[]>{<><>}>(<(){}><[]()>))>](([(<{}[]>(()()))<<{}{}|[[[<(([([<{<<<<><>>([]{})>{{{}()}<[]()>}><[{{}{}}(<><>)]>}<(({{}()}(<>[]))({[]()}[[]]))(<[[]()](())>({{|(([<{<<[[<{(([[]]<<>>){([]{})<(){}>})}>{{{[<<>[]>([][]>]}}[{[{<>[]}[<><>]][[<>()]({}())]}(<{[]}[()[]]><|[<<[{{({[{{[<<<><>>[{}<>]>[<<>{}>(()[])]]}}<[(<<{}[]]([]<>)>)[[{<><>}{()()}]<<<>()>>]]<({(<>{})}[{|[<{<({{[[<<<[([]{}){[]<>]][<<>{}>]>{[[[]<>][<>[]]]}>>{[[<(()())<<>[]>>[{{}[]}{[][]}]][[([]())<()<>>][([]<>)<[|<{<{<[(((<((<[()<>]<[]()>>{<<>()>(<>[])}))>)[([(([()]<{}[]>)[{<>()}[[]{}]])<<[[]<>][{}]>{[{}()]([]<>)}>|([{[{(({{((([{[]()}[[]()]])[<({}<>){<>{}}>{{{}[]}{()()}}])[[((()<>)[<><>])[({}<>)({}())]]]}[[[[<<>()>[{}[]]]|[[[<[<{[(<<(({[]<>}(<><>)){[()<>]})>><([[<[]()>]([<>[]]<()[]>)]{({{}()}<[]<>>)[({}<>)<<>{}>]>)[<({{|<{{[[[<([<<<(<[]()>)([<>[]]<{}{}>)>[[[[][]]](<()[]>[()[]])]>>]{{[(({<>()}{<><>}){(()<>}[[]{}]}|{<{<((([<{<{[{[][]}{[]()}][({}[]){{}[]}]}{((<><>)(<>{}])(<{}()><<><>>)}>(<{{<>{}}{()()}}>[<(<><>)[<>|<{[<<[([[<<{[<<>[]>](<{}()>)}[(<<>{}>{{}[]})<[(){}][[]()]>]>>]<{{[<{()()}{()[]}>[(<>[]){()()}]][{(|[[<<(<{{<{{{([{}()][[]]){{()[]}((){})}}[[[<><>]{<>}]{[<>[]]{(){}}}]}(<([()()][()()]){{()}([]())}>)}[[|[<[{<((<{{((<{{}<>}[{}()]>[{[]()}{[]<>}])({[()()]}[{<>>([]{})]))}<((((<>{})(()<>)){{[][]}})){[{<<>[]>[{}{}|[[([<{[[((<(<<{}{}>><{[]<>}>){<<()<>>[{}{}]>}><{[[()[]]{()()}][(<>{})]}{{{[][]}<[]()>}(<<>[]><(){}|[[{<{[<<(({(<[[]()]<[]()>>([(){}]<{}>)){<[[]{}]{[]<>}>{<[]{}>[()<>]}}}{(((()){{}[]}){[<>{}]{[]()}})[({[]{}|([<{{(({{<<<<({}[]){(){}}>{({}[])<[][]>}>[{(()<>)([]{})}(<[]()><{}[]>)]>({{{()[]}{(){}}}({()()}<[]{}|<[({{({{{(([{(<>()){[][]}}[([]{})<[][]>]]{<[<>[]]<<>{}>>[[{}<>][{}[]]]})<([(())[()<>]](([]())[(){}]|(<[<<<{{<([{[(<>{})(()<>)]([{}]{[][]>)}({{()[]}}((()()){(){}}))]([({()}[[]<>]){{<>[]}(()())}]<{[[]()]{{|({{((<(([{{[<[{}{}][[][]]><[{}()]{[]{}}>]{<[<><>](<><>)>[{[]()}<<>[]>]}}<[{{[]{}}<(){}>]{{<>}<()<>>}][((<>|({(({<<{(<<<[(()<>)((){})]<[<><>]<<>[]>>>([{(){}}{<>()}][({}())])><{<<<><>>(()())>{{{}()}[[][]]}|({((<{((({<<<[{}{}][[]()]>[<{}<>>{{}<>}]>(<[[]<>][{}[]]>>>[[[<()>{()<>}]<{<><>}<[][]>>]{<(<|{<<<[{(<{([{<<()()>((){})>}([[()()]](<<>())([][])))]({[({}<>){[][]}][(<>){<>[]}]}[{[{}[]]<[|[[[{{[{((([{(<{}()><{}[]>)<{{}[]}[()()]>}{{{<>[]}[()()]}(([]{})[()()])}][<(({}())({}()))(({}<>)[{}|<[{({[{[([[<(<(){}>{<>{}})>(([()[]]<[]{}>)<{{}()}{()<>}>)]][[<(<[]{}><()()>)[[()()]<(){}>]><[<()()><{}<>>]>|[({<{[(<{([[[<[][]>{[]{}}]{{(){}}[{}()]}]{[(<><>)[<>{}]]{{[][]}}}])}><<[[[{({}())((){})}({{}{}}{[][]})]({<[]|[{{(({[<[<({(<[][]>({}[]))[[()<>][()()]]})<[({<>}(<><>))[<<>[]>(<><>)]]<<[()[]]<<>()>>([()()]<[]<>>)>>>]|<[[<{([((<[<<<{}()><<>[]>>{{[][]}}>[{{<><>}({}{})}<[{}()]>]]>){[((((()()){(){}})[[{}{}]{[]()}]))(<(([|((<{{[(({(<([{{}()}{(){}}]<({}{})[[][]}>)><{{<()[]>({}())}<[<>[]]{<>[]}>}>)<<[[[<>{}](<>[])][{()}]]({(<>|<([[([{[<[[<<(<><>)<()>>>]]<[<({<>[]}<[]>)><<({}())<{}<>>><({}())>>][(([<>{}]{()<>})[[{}<>]{()[]}])({<()()>|[<[<[({<<({<{<[]<>>}[{<>[]}]>})>>}[<[(({([[]<>]<<>>)[<[]{}>]}))]>(([{<[[{}[]]<<>[]>]<{{}()}<[]|[<[[(<<{[{{<<(<>{})<{}()>><<{}<>>(<>())>><{([][])[{}()]}[{[]{}}{{}[]}]>}<<<({}{}}[[]<>]><[|<[{{([({[(<([(<>[])<[][]>][<[]{}>(<>)]){<[()<>]({}())>([{}()](()<>))}>(<{<<>()>[()]}>{{[<>[]]{()()}}{{|(<<{[([([<{[[{{}()}(<><>)){[[][]]}]({<(){}>{()[]}}<((){}){[]()}>)}>(<(<<[]<>>{{}}>)>[[(<{}<>>{(){}}){{|(((((<[<<([<<<[]{}>{<>[]}>(<[][]>[[][]])>])<<<{[<>[]]({}{})}[{()[]}<<>()>]>({<{}()><{}[]>}|(([[[[[{[[{(((<>{})([]<>))(([]{})<()<>>))({{<>()}{[]()}}<<()()>(()[])>}}<[[{{}{}}(<>{})]{[[]()]{{}<>}}][<{<>(|(<{{[{(((((<[<<><>>]>({(()<>)<{}<>>}{<<>[]>({}{})}))){<<<[{}[]][<>()]>><[<<>[]>]<[()()]<{}<>>>>>{[{{()[|[[({<[{{{<[<{({}<>)<<>{}>}({<>[]}([]<>))>[{(<><>){<>}}({{}[]}([][]))]]>{{<[<{}>(()<>}]{<{}<>><(|[<{{(<[<({[[{(<>()){{}[]}}[([][])<(){}>]]]<(<{{}{}}([]())>([[]{}]<[]<>>))<[<<><>>[<>{}]](([]()){<>|{{{<(<<([{({[<{}{}>[[]<>]]{{(){}}[[]{}]>}(((()())[<>[]])((()[])[(){}])))<{<[{}{}]>}{(<{}[]>{{}<>})<|(<<[<{{{{(<<(({}[])[()[]])<([]{})>>({({}())({}[])}{{<>[]}(()())}]>{[[[{}()]{<>()}]<(()())[<><>]>]}|[<{<{(([((<{[{[]<>}(()[])]}[[[()()]{{}[]}]<<(){}>{()<>}>]><((<[]><{}{}))[{{}<>}])[{([][])<[]{}>}|(<(<{[((((<(([()[]][<>()])<[[]]<{}[]>>)<<{{}()}([]<>)>({()()}(<><>))>>[([(()[])<[]<>>]{{()()}})[{(<>())[{}|[<{(<((<[[[[[{[]<>}<<>{}>]([[][]]({}[]))]{([{}()][<><>])}]{<[({}<>)({}{})]<((){}){<>{}}>>({[[](|([{[[<<[{(<(({[]<>}))><{[{{}<>}[()<>]]{{{}{}}<<>()>}}{({<>{}}<[]{}>)((<>{})([]{}})}>)<{[((()())(|({([{{<{[<[[<({}[])[[][]]>{{{}()}{{}[]}}]><{(<<><>>{[]()})[{<>()}[{}{}]]}[{[{}[]](<>())}([()]{{}<>|{{<{{{([(({<<[(){}]{()<>}>>({{{}<>}}{[<>()]})}[[[<{}()>(<>{})]<{{}<>}>][(({}())<<>()>)(({}<>){[]()})]]))[({<|{{<((((<{{[([(<>())(<>[])])([[(){}]{<><>}]{<<>{}>({}())})]((({[]()}(<>()))(<[]{}>[{}<>]))<([[]()]{<>()})<|(<[(([<{({<<{[<>{}]<[]()>}([<>{}}(<>()))>([<{}<>>[(){}]])>}){<[[{{[]{}}({}())}{<(){}>{()[]}}]{([[]{}]<{}[]>)|[[{[{<<((<[((<{}()>({}<>)))({([]<>)}({{}[]}(<>{}))}]{<<{(){}}>{[[]{}]([]<>)}><<[{}{}]<[]{}>>|<<<[<[<([[{<{((){}){<>()}}[[{}()]((){})}>}[(<<{}{}>[<>()]>{(<>{})[()<>]})[[(()<>)[[]()]][(()[])<|[<((([{{([{<[<[]<>>(()())]<[()()]{<>())>><<[{}[]]<()<>>>[([]()){[]()}]>}{<([{}{}]<(){}>)[{<>{}}(|{[[[([((<[[({({}{})[<><>]}[[<>[]]((){})])(<(()[]){{}<>}><<{}<>>([]<>)>)]]([<[{<><>}[{}<>]]|(<[[[<([[[[{{<()<>>{()<>}}{[[]{}][{}<>)}}<({()[]}([])){(()[])({}())}>](([{{}[]}{<>{}}](([][])([][]))))]]<{|[[({<<{{{<(<{<()[]>[[]<>]}{({}<>)}>(([{}<>]{{}[]})))>}([[{[[<><>](<>[])]}({<<>()>})][{{{()()}{[]()}}(({}[])(<|[{[{{<{(<((<{[{}[]][<><>]}{<(){}>[[]{}]}>))<{[[<()[]><(){}>]<{[]<>}[()()]>]{(([]{})<[]>)(([|([{{<[[[<{<<<{[]}{<>()}><[()()]{[]<>}>>[{[<>()>[<>()]}[[[]<>]{<><>}]]>(({[()()]{<><>}}[(<>|[(<[[<<{{(({[<{}()>][{[][]}{{}<>}]}[<<<><>>>{([]<>){[]<>}}]))<(<[[()()][()()]]({(){}}[(){}])>{<(<>[])<{|<[(<<{{[[{(([<<><>>{()()}]({()()}{{}{}}))<[{()()}<()()>]([{}[]]<[][]>)>)>]{(<[(({}())[[][]]){({})<|<({<{<(<<[<[[[{}{}][[]{}]][{[]{}}{{}<>}]]><<{[{}{}]([]{})}([[]{}])>{<(<>{}){[]<>}>{{{}<>}([][])}}>](|<[[[<(({[<<<({<>()}{[][]}>{({}<>){()}}>[{{<>[]}{()()}}[<{}[]>[<><>]]]>[<<(<>{})>([()<>][{}|(<({{(((<{{({[{}<>){[]<>}}[({}()){{}[]}])[{<[]{}>(<>())}([()[]](<>()))]}{{(<()()>){{<>()}}}[{[|[(<<<(<{(<{[{[[]()]{<>[]}}]{{[{}()][<><>]}<([][])<{}>>}}><{<<[{}()][<>()]}{({}<>)(()())}><<{{}()}<{}|(({<{[[{<<<[[<()()>[[][]]]{{<>()}{()()}}]<(([]{})[[][]])>>>{[<[<[]()>[()[]]]<([]())(()<>)>>]<({{(){}}{|{{[{{<[[[({{(({}[])[{}()])([{}()]{()<>}>}[[[<>()]{[][]}]{<()()>[<><>]}]}(<{[()()]({}<>)}[{()<>}{{}[]}]|{<[[[{([(((({([]<>)}[[<>[]]]){[(()[])([][])]{[()]<<>{}>>})[[{(<>[])[{}()]}{{{}()}([]<>)}]{<<<>{}>([|<({{([<<{<[((<(){}>{<><>])[{[][]}{{}{}}])]({[{{}[]}{()[]}][[()()](<>{})]}{(({}{}){[]()})})>}>>](<{|[{{{(<<{<<<[(<{}<>>)]>><[{(<[]{}>{{}<>})[[<>{}]]}([[()()]<{}<>>])]<([<()[]>{{}{}}][[{}[]]<[]{}>])>|<[(<[[<[[({[(({}())([]()))<[[]{}](<>{})>]{<<[][]><{}{}>>{[<>{}]([]())}}}){((({[][]}{<>[]}){[{}{}|[((<<[[<[{{(([<><>])({()[]}<[][]>)]}}]<<([{[()()]<[]<>>}<[{}[]][<><>]>])<<<[<><>]<{}[]>>{{[][]}}>{<{<>[]}<()|<{<[(<[({[<<(<{}{}>{{}{}})<(()<>){(){}}>][{<{}><<>()>}[(()[])<()()>]]>][[[{{{}<>}((){})}][([()[]]|[((((<{[{{{<{(<>{})(<>[])}<[(){}][[]<>]>>>}}(<((<({}[])<()<>>>)(<[()[]][<>{}]><[[][]](()<>)>))((|{[[<<[(((([(([<>[]]{()()})([<>[]]((){})))]{{[<{}<>><{}<>>]<{{}[]}(<>[])>}})<[([{{}()}((){})]{(<>{})<[]>})([<[|<{(<<[(<<[{{(([])[<>{}])((()<>){[][]})}}]({([<{}>[[][]]](<(){}>{<>()}))[[<[]{}>](<()()>[()<>]|[<({{{[(([{<({()()}<()<>>)<{<>{}}>>(<<()>[[]()]>[{()<>}<[]{}>])}]<<{<[<>[]]([]<>)>}><{{[<>()]({}(|<<<({{({{[([[([]{})<()()>]<<<>()><[]()>>]({<[]()>[{}<>]}{{<>{}}{()()}}))<({((){})[[][]]}(({})<|((<<{<[[([{(<((){})<<>[]>>{[[][]]<()[]>}){<(<>()){()[]}>[[[]<>]([]<>)])}]((<{{[]<>}{[]<>}}>|({({{{(<<{<<([{}{}](()()))((<>{}){[]{}})>([[()<>]](([]())<[]{}>))>{[((()()))<((){})([]<>)>]((<|<{{[[([{<{([<[()[]]>([()<>]([]))]<{{()()}{[]<>}}{{{}[]}<()>}>)<{[([]<>){()<>}][[()()][(){}]]}(({<><>|{<{{({[[{<([{[()()][()<>]}[([]{})(<>())]))<<[(<>[]){{}()}][<<><>>[[]]]>>><{<<[()[]]({})>[[[]]<(|(<[{{{{{<{<((({}<>)[<>()]))([<<><>>[()[]]])>}>([[{{[[]{}]<<>()>}}{({[]{}}([]{}))}>[(<({}()){()()}>|<(([[([{<<{(<<[]>{()[]}>{[[]<>]<<><>>}){[<[]()>[<>{}]][([]{})<<><>>]}}>>{{<[<{[]<>}([]{})]{({}<>){|<<{(<{<(<([{<{[]<>}>({[]()}{{}()})}<[{<>()}{<>()]]<<[]()>{()()}>>]<(([[]]{()()})[{{}[]}{{}}])(([{}|<[<{[([[({<[[{()[]}({}[])]]([<<>{}>(<><>)]<([]())[{}<>]>)>[(((()){{}[]})(<[]>(()<>)))<[<<><|<({{<<<<<<[<[{<>[]}[<>{}]]<<()()>{()}>>[<({}[])((){})>[<[]<>>[[]()]]]]>{{{[[[]{}](<>())]}}({(({}()){<>}|({(<{[<<{[([{[[]()]<(){}>}<{()()}<(){}>>][([()()][<>[]])<([]())(()())>])]({[<<[]<>>{[][]}>|[[(([<{<(<<[{{{}[]}[{}<>]}{<[]<>>[(){}]}]<{<()[]>{{}{}}}{{<>[]}{(){}}}>>{<[{()[]}{[]}]{{{}}{{}<|{{({<<({[<{([[{}{}][{}<>]][([]{})<{}()>])<[[<><>][[]()]]{(<>{})<{}[]>}>}>{<([[{}{}](<>[])]{{<>[]}|<((((({<([<({[()<>]([]())}({(){}}{<><>}))([[{}<>]([]<>)])><([<()()>[()<>]][[{}<>][{}()]]){[[<>[|[(<<[{<[([(({[[]{}][[][]]}[([]<>){()}]){[{{}{}}{[][]}]{{()[]}[<><>]}}){(((()[])([]())))[[[{|{{([<{([(<[(<<[]>{[]<>}>({<>()}<[][]>))]<<<[{}<>][{}{}]>[<()<>><{}{}>]><(<{}()>{<>()})[<()<>)([][])]>>><[<[|<{[[<{<{<<[{<[[][]]<(){}>>{([]())[<>()]}}[[<()<>>({}{})]{([]<>){[]()}}]]>>}<{{({(({}{})<<>()>)[([])([]{})]})|{[{{[[{<<{<[[<<><>>[<>[]]]<<{}<>><<>()>>]([[{}<>][{}[]]]([(){}]<<>()>))>{{<(()[])((){})>([{}<>]{<>()})}|[(((<{[({<{[<([])<[]{}>><(()<>){()<>}>]<[({}<>)({}[])]<(<>)({}{})>>}>}]][(<({(<<[][]>>([()|([<{<[<[{[<{<<<>{}>>{<<>()>[{}[]]}}<[{{}{}}[[][]]][(<>[])[{}[]]]>>{[[(<><>)[()<>]][({}<>)[<>(|<<{<([([<[{([(<><>)<<>[]>][((){})(<>[])])<([()[]]{[][]})(({}<>)<(){}>)>}([{({}{})<<>>}[{(){}}[<>{}]]])][((|[<<<((<{{{({[[[]{}][<>[]]]}{[{()[]}<{}{}>]<(<>{})(()<>)>})}(<<<[(){}]{[][]}>([{}<>]{()[]})>><{{<[]<>>{{|{{[<<(<{(<(<{((){})([]())}(({}{})<{}{}>)>[[{[]}<[]())]{<{}{}>(()())}])<([(()<>)[()[]]]((()())([][])|{(<<[(([{[<{({[]<>}(()())){<<>()><()()>}}<[(<>[])<<><>>]{[<>[]]<{}[]>}>>]}<{<<{[(){}]({}())}[(<>())]>|(({{(<{[{{[<<[(){}]<<>[]>>((<>())<()()>)><(<()[]>)<[[]{}]<<>>>>][{(<()()><<>{}>)<(<><>){[]{}}>}]}})([(<<[<<>|{({(<[[{([{(<{()()}<<>()>>)<(<{}[]}{(){}})[{[]<>}[[][]]]>}<[[[<>[]]<<>()>][[<>{}]]]<<(()[])([]|[({[[{<({[{[<<<>{}][[]()]>]}][(({((){}){(){}}}[[[][]]<[]()>])([([][])[(){}]]))]})>}[(<({{[<({}{';
const example = '[({(<(())[]>[[{[]{<()<>>|[(()[<>])]({[<{<<[]>>(|{([(<{}[<>[]}>{[]{[(<()>|(((({<>}<{<{<>}{[]{[]{}|[[<[([]))<([[{}[[()]]]|[{[{({}]{}}([{[{{{}}([]|{<[[]]>}<{[{[{[]{()[[[]|[<(<(<(<{}))><([]([]()|<{([([[(<>()){}]>(<<{{|<{([{{}}[<[[[<>{}]]]>[]]';

const lines = input.split('|');

const CHARS = {
    '[': {close: ']', count: 0, score: 57, completionScore: 2},
    '{': {close: '}', count: 0, score: 1197, completionScore: 3},
    '<': {close: '>', count: 0, score: 25137, completionScore: 4},
    '(': {close: ')', count: 0, score: 3, completionScore: 1}
};

function getOpener(char) {
    switch (char) {
        case ']':
            return '[';
        case ')':
            return '(';
        case '}':
            return '{';
        case '>':
            return '<';
    }
}

(() => {
    lines.forEach(line => {
        let segment = [];
        let corrupted = false;
        const charsInLine = line.split('');
        for (let charIndex = 0; charIndex < charsInLine.length && !corrupted; charIndex++) {
            let char = charsInLine[charIndex];
            if (Object.keys(CHARS).includes(char)) {
                segment.push(char);
            } else if (CHARS[(segment[segment.length - 1])].close === char) {
                segment.pop();
            } else {
                corrupted = true;
                CHARS[getOpener(char)].count++;
            }
        }
    });

    console.log(Object.values(CHARS).map(c => c.score * c.count).reduce((t, n) => t + n));
})();

(() => {
    const lineScores = [];
    lines.forEach(line => {
        let segment = [];
        let corrupted = false;
        const charsInLine = line.split('');
        for (let charIndex = 0; charIndex < charsInLine.length && !corrupted; charIndex++) {
            let char = charsInLine[charIndex];
            if (Object.keys(CHARS).includes(char)) {
                segment.push(char);
            } else if (CHARS[(segment[segment.length - 1])].close === char) {
                segment.pop();
            } else {
                corrupted = true;
            }
        }

        if (!corrupted) {
            lineScores.push(segment.reverse().reduce((partialScore, char) => {
                return partialScore * 5 + CHARS[char].completionScore
            }, 0));
        }
    });

    console.log(lineScores.sort((a, b) => a - b)[Math.floor(lineScores.length / 2)]);
})()
